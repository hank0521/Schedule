# å°ˆæ¡ˆå»ºç½®æŒ‡å—

## ğŸ“‹ ç›®éŒ„
- [ç’°å¢ƒéœ€æ±‚](#ç’°å¢ƒéœ€æ±‚)
- [æœ¬åœ°é–‹ç™¼ç’°å¢ƒå»ºç½®](#æœ¬åœ°é–‹ç™¼ç’°å¢ƒå»ºç½®)
- [Docker ç’°å¢ƒå»ºç½®](#docker-ç’°å¢ƒå»ºç½®)
- [ç’°å¢ƒè®Šæ•¸è¨­å®š](#ç’°å¢ƒè®Šæ•¸è¨­å®š)
- [æ¸¬è©¦åŸ·è¡Œ](#æ¸¬è©¦åŸ·è¡Œ)

---

## ç’°å¢ƒéœ€æ±‚

### æœ¬åœ°é–‹ç™¼
- **Python**: 3.10+
- **PostgreSQL**: 15+
- **pip**: æœ€æ–°ç‰ˆæœ¬

### Docker é–‹ç™¼
- **Docker**: 20.10+
- **Docker Compose**: 2.0+

---

## æœ¬åœ°é–‹ç™¼ç’°å¢ƒå»ºç½®

### 1. å…‹éš†å°ˆæ¡ˆ
```bash
git clone <repository-url>
cd Schedule/API
```

### 2. å‰µå»ºè™›æ“¬ç’°å¢ƒ
```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### 3. å®‰è£ä¾è³´
```bash
pip install -r requirements.txt
```

### 4. è¨­å®šç’°å¢ƒè®Šæ•¸
```bash
# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
cd ..
cp .env.example .env
```

ç·¨è¼¯ `.env` æª”æ¡ˆï¼Œè¨­å®šä»¥ä¸‹å¿…è¦åƒæ•¸ï¼š
```env
# è³‡æ–™åº«è¨­å®š
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=SYSDATA
POSTGRES_USER=sa
POSTGRES_PASSWORD=your_password

# API è¨­å®š
APP_NAME=Schedule API
DEBUG=True
SECRET_KEY=your-secret-key
API_KEY=your-api-key

# åŠ å¯†é‡‘é‘° (ä½¿ç”¨ä¸‹æ–¹æŒ‡ä»¤ç”Ÿæˆ)
ENCRYPTION_KEY=your-encryption-key

# CORS è¨­å®š
CORS_ORIGINS=["http://localhost:3000","http://localhost:8080"]

# æ—¥èªŒè¨­å®š
LOG_LEVEL=INFO
LOG_FILE_MAX_BYTES=10485760
LOG_FILE_BACKUP_COUNT=5
```

### 5. ç”ŸæˆåŠ å¯†é‡‘é‘°
```bash
python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
```
å°‡ç”Ÿæˆçš„é‡‘é‘°è¤‡è£½åˆ° `.env` çš„ `ENCRYPTION_KEY`

### 6. æº–å‚™è³‡æ–™åº«
ç¢ºä¿ PostgreSQL å·²å®‰è£ä¸¦é‹è¡Œï¼š
```bash
# å»ºç«‹è³‡æ–™åº«
psql -U postgres -c "CREATE DATABASE SYSDATA;"

# åŸ·è¡Œåˆå§‹åŒ– SQL (å¦‚æœæœ‰)
psql -U sa -d SYSDATA -f ../Database/CreateTable.sql
```

### 7. å•Ÿå‹• API æœå‹™
```bash
cd API

# æ–¹æ³• 1: ä½¿ç”¨ uvicorn
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# æ–¹æ³• 2: ä½¿ç”¨ run.py (å¦‚æœå­˜åœ¨)
python run.py
```

### 8. é©—è­‰æœå‹™
æ‰“é–‹ç€è¦½å™¨è¨ªå•ï¼š
- **å¥åº·æª¢æŸ¥**: http://localhost:8000/health
- **API æ–‡ä»¶**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

---

## Docker ç’°å¢ƒå»ºç½®

### 1. è¨­å®šç’°å¢ƒè®Šæ•¸
```bash
cd Schedule
cp .env.example .env
```

ç·¨è¼¯ `.env` æª”æ¡ˆï¼ˆè‡³å°‘è¨­å®šå¯†ç¢¼å’ŒåŠ å¯†é‡‘é‘°ï¼‰ï¼š
```env
POSTGRES_PASSWORD=your_strong_password
ENCRYPTION_KEY=your-encryption-key-here
```

### 2. ç”ŸæˆåŠ å¯†é‡‘é‘°ï¼ˆDocker æ–¹å¼ï¼‰
```bash
docker run --rm python:3.10-slim python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
```

### 3. å•Ÿå‹•æ‰€æœ‰æœå‹™
```bash
# å•Ÿå‹• PostgreSQL + API
docker-compose up -d

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f api
```

### 4. å•Ÿå‹•ç‰¹å®šæœå‹™
```bash
# åƒ…å•Ÿå‹•è³‡æ–™åº«
docker-compose up -d postgres

# åƒ…å•Ÿå‹• API
docker-compose up -d api
```

### 5. å•Ÿå‹• pgAdminï¼ˆå¯é¸ï¼‰
```bash
docker-compose --profile tools up -d pgadmin
```
è¨ªå•: http://localhost:5050

### 6. é©—è­‰ Docker éƒ¨ç½²
```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps

# æ¸¬è©¦ API å¥åº·æª¢æŸ¥
curl http://localhost:8000/health

# æ¸¬è©¦è³‡æ–™åº«é€£ç·š
curl http://localhost:8000/health/db
```

é æœŸè¼¸å‡ºï¼š
```json
{
  "status": "healthy",
  "timestamp": "2025-10-05T12:00:00.000000",
  "version": "1.0.0"
}
```

---

## ç’°å¢ƒè®Šæ•¸è¨­å®š

### å®Œæ•´ç’°å¢ƒè®Šæ•¸èªªæ˜

| è®Šæ•¸åç¨± | èªªæ˜ | é è¨­å€¼ | å¿…å¡« |
|---------|------|--------|------|
| `POSTGRES_HOST` | è³‡æ–™åº«ä¸»æ©Ÿ | localhost | âœ… |
| `POSTGRES_PORT` | è³‡æ–™åº«ç«¯å£ | 5432 | âœ… |
| `POSTGRES_DB` | è³‡æ–™åº«åç¨± | SYSDATA | âœ… |
| `POSTGRES_USER` | è³‡æ–™åº«ä½¿ç”¨è€… | sa | âœ… |
| `POSTGRES_PASSWORD` | è³‡æ–™åº«å¯†ç¢¼ | - | âœ… |
| `APP_NAME` | æ‡‰ç”¨åç¨± | Schedule API | âŒ |
| `DEBUG` | é™¤éŒ¯æ¨¡å¼ | False | âŒ |
| `SECRET_KEY` | API å¯†é‘° | - | âœ… |
| `API_KEY` | API èªè­‰é‡‘é‘° | - | âœ… |
| `ENCRYPTION_KEY` | åŠ å¯†é‡‘é‘° | - | âœ… |
| `CORS_ORIGINS` | CORS å…è¨±ä¾†æº | ["*"] | âŒ |
| `LOG_LEVEL` | æ—¥èªŒç­‰ç´š | INFO | âŒ |
| `LOG_FILE_MAX_BYTES` | æ—¥èªŒæª”æ¡ˆå¤§å°ä¸Šé™ | 10485760 | âŒ |
| `LOG_FILE_BACKUP_COUNT` | æ—¥èªŒå‚™ä»½æ•¸é‡ | 5 | âŒ |

---

## æ¸¬è©¦åŸ·è¡Œ

### æœ¬åœ°ç’°å¢ƒæ¸¬è©¦
```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pytest tests/ -v

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦æª”æ¡ˆ
pytest tests/test_core/test_database.py -v

# åŸ·è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
pytest tests/ --cov=app --cov-report=html
```

### Docker ç’°å¢ƒæ¸¬è©¦
```bash
# é€²å…¥ API å®¹å™¨åŸ·è¡Œæ¸¬è©¦
docker-compose exec api pytest tests/ -v

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦
docker-compose exec api pytest tests/test_core/test_database.py -v

# æŸ¥çœ‹æ¸¬è©¦è¦†è“‹ç‡
docker-compose exec api pytest tests/ --cov=app --cov-report=term-missing
```

---

## å¸¸ç”¨æŒ‡ä»¤

### Docker ç®¡ç†
```bash
# åœæ­¢æ‰€æœ‰æœå‹™
docker-compose down

# åœæ­¢ä¸¦åˆªé™¤è³‡æ–™ï¼ˆå±éšªï¼‰
docker-compose down -v

# é‡æ–°å»ºç½® API
docker-compose up -d --build api

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f api
docker-compose logs -f postgres

# é€²å…¥å®¹å™¨
docker-compose exec api bash
docker-compose exec postgres bash

# åŸ·è¡Œ psql
docker-compose exec postgres psql -U sa -d SYSDATA
```

### æœ¬åœ°é–‹ç™¼
```bash
# æ›´æ–°ä¾è³´
pip install -r requirements.txt --upgrade

# æ ¼å¼åŒ–ç¨‹å¼ç¢¼ï¼ˆå¦‚æœæœ‰ä½¿ç”¨ blackï¼‰
black app/ tests/

# æª¢æŸ¥ç¨‹å¼ç¢¼é¢¨æ ¼ï¼ˆå¦‚æœæœ‰ä½¿ç”¨ flake8ï¼‰
flake8 app/ tests/

# æŸ¥çœ‹è³‡æ–™åº«é€£ç·š
python -c "from app.config import settings; print(settings.DATABASE_URL)"
```

---

## ç–‘é›£æ’è§£

### API ç„¡æ³•å•Ÿå‹•
1. æª¢æŸ¥æ—¥èªŒï¼š
   ```bash
   # Docker
   docker-compose logs api

   # æœ¬åœ°
   cat logs/schedule_api.log
   ```

2. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸æ˜¯å¦æ­£ç¢ºè¨­å®š
3. ç¢ºèªè³‡æ–™åº«æ˜¯å¦å·²å•Ÿå‹•ä¸¦å¯é€£ç·š

### è³‡æ–™åº«é€£ç·šå¤±æ•—
1. ç¢ºèª PostgreSQL æ­£åœ¨é‹è¡Œ
   ```bash
   # Docker
   docker-compose ps postgres

   # æœ¬åœ°
   pg_isready -h localhost -p 5432
   ```

2. æª¢æŸ¥é€£ç·šå­—ä¸²
   ```bash
   docker-compose exec api python -c "from app.config import settings; print(settings.DATABASE_URL)"
   ```

3. æ¸¬è©¦æ‰‹å‹•é€£ç·š
   ```bash
   psql -h localhost -U sa -d SYSDATA
   ```

### æ¸¬è©¦å¤±æ•—
1. ç¢ºèªæ¸¬è©¦è³‡æ–™åº«å­˜åœ¨
   ```bash
   # æª¢æŸ¥æ¸¬è©¦è³‡æ–™åº«
   docker-compose exec postgres psql -U sa -d postgres -c "\l"

   # æ‰‹å‹•å»ºç«‹æ¸¬è©¦è³‡æ–™åº«ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
   docker-compose exec postgres psql -U sa -d postgres -c "CREATE DATABASE \"SYSDATA_test\""
   ```

2. æ¸…ç†æ¸¬è©¦è³‡æ–™
   ```bash
   docker-compose exec postgres psql -U sa -d SYSDATA_test -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"
   ```

---

## ä¸‹ä¸€æ­¥

å»ºç½®å®Œæˆå¾Œï¼Œè«‹åƒè€ƒï¼š
- **2.DEVELOPMENT.md** - äº†è§£é–‹ç™¼å·¥å…·èˆ‡è¦ç¯„
- **4.API_UPDATES.md** - æŸ¥çœ‹ API ç«¯é»æ–‡ä»¶
