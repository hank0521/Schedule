# 更新日誌

所有重要的專案變更都會記錄在此文件中。

格式基於 [Keep a Changelog](https://keepachangelog.com/zh-TW/1.0.0/)，
版本號遵循 [Semantic Versioning](https://semver.org/lang/zh-TW/)。

---

## [Unreleased]

### 計劃中
- HTTP 排程任務 CRUD API
- Mail 排程任務 CRUD API
- FTP 排程任務 CRUD API
- 任務執行引擎
- 任務監控儀表板

---

## [0.1.0] - 2025-10-05

### Added (新增)

#### 專案架構
- ✅ 建立 FastAPI 專案基礎架構
- ✅ 設定 Docker 與 Docker Compose 部署環境
- ✅ 配置 PostgreSQL 資料庫
- ✅ 建立測試架構（pytest + pytest-asyncio）

#### 核心模組 (core/)
- ✅ **DatabaseManager** - 統一資料庫操作管理類別
  - 支援 CRUD 操作（create, read, update, delete）
  - 支援原始 SQL 查詢（execute_query, execute_scalar, execute_non_query）
  - 支援 Transaction 管理
  - 連線池配置（pool_size=10, max_overflow=20）
  - 自動健康檢查（pool_pre_ping）

- ✅ **HTTPClient** - HTTP 請求客戶端
  - 支援所有 HTTP 方法（GET/POST/PUT/DELETE/PATCH）
  - 自動重試機制（可配置次數與間隔）
  - 超時處理
  - SSL 驗證開關

- ✅ **FTPClient** - FTP/SFTP 客戶端
  - 支援 FTP 和 SFTP 協定
  - 工廠模式建立客戶端（FTPClientFactory）
  - 批次上傳（支援萬用字元）
  - 上傳後刪除本地檔案選項

- ✅ **MailClient** - Email 發送客戶端
  - SMTP/SMTPS 支援
  - HTML/純文字格式
  - 附件功能
  - 多收件者（To/CC/BCC）

- ✅ **CryptoService** - 加密解密服務
  - Fernet 對稱加密
  - 密碼加密儲存

- ✅ **Logger** - 日誌服務
  - 多等級日誌（DEBUG/INFO/WARNING/ERROR/CRITICAL）
  - Console + File 雙輸出
  - 檔案輪替（RotatingFileHandler）

#### 資料模型 (models/)
- ✅ **ScheduleHttp** - HTTP 排程任務模型
- ✅ **ScheduleMail** - Mail 排程任務模型
- ✅ **ScheduleFtp** - FTP 排程任務模型
- ✅ **ScheduleException** - 例外記錄模型
- ✅ **ScheduleExecutionHistory** - 執行歷史模型

#### 工具模組 (utils/)
- ✅ **validators.py** - 資料驗證工具
  - Cron 表達式驗證
  - Email 格式驗證
  - URL 格式驗證
  - HTTP 方法驗證
  - 端口號驗證

- ✅ **exceptions.py** - 自訂例外類別
  - ScheduleAPIException（基礎）
  - DatabaseError
  - HTTPClientError
  - FTPClientError
  - MailClientError
  - ValidationError

- ✅ **helpers.py** - 輔助函式
  - 日期時間解析與格式化
  - 字串分割
  - 檔案大小格式化

#### API 路由 (routers/)
- ✅ **health.py** - 健康檢查端點
  - GET `/health` - API 健康檢查
  - GET `/health/db` - 資料庫連線檢查

#### Schemas (schemas/)
- ✅ **common.py** - 共用 Schemas
  - ExecutionStatus 列舉
  - ServiceType 列舉
  - ErrorResponse
  - SuccessResponse
  - PaginatedResponse（泛型）
  - HealthCheckResponse
  - DatabaseHealthResponse

#### 配置與文件
- ✅ **config.py** - 配置管理
  - 環境變數自動讀取
  - 資料庫連線字串自動產生
  - CORS 設定解析

- ✅ **main.py** - FastAPI 應用程式
  - CORS 中介軟體
  - Lifespan 事件管理
  - 路由註冊
  - Swagger/ReDoc 文件

- ✅ **requirements.txt** - 依賴清單

- ✅ **.env.example** - 環境變數範本

- ✅ **Dockerfile** - Docker 映像檔

- ✅ **docker-compose.yml** - Docker Compose 配置

#### 測試 (tests/)
- ✅ **conftest.py** - Pytest 配置
  - 測試資料庫自動建立
  - Fixture 定義

- ✅ **test_database.py** - DatabaseManager 測試
  - 18 個測試案例
  - 涵蓋所有 CRUD 操作
  - Transaction 測試
  - 原始 SQL 測試

- ✅ **test_http_client.py** - HTTP Client 測試

- ✅ **test_validators.py** - Validators 測試

#### 文件
- ✅ **1.BUILD.md** - 專案建置指南
  - 本地環境建置
  - Docker 環境建置
  - 環境變數設定
  - 測試執行

- ✅ **2.DEVELOPMENT.md** - 開發工具與規範
  - 核心類別使用指南
  - DatabaseManager 詳細文檔
  - 開發規範
  - 最佳實踐

- ✅ **3.CHANGELOG.md** - 更新日誌（本檔案）

- ✅ **4.API_UPDATES.md** - API 更新文件

### Changed (變更)
- 統一環境變數管理，移除 `API/.env`，只保留根目錄 `.env`
- 更新 `config.py` 從根目錄的 `.env` 讀取配置
- 修正 `pytest-asyncio` 相關警告，移除舊的 event_loop fixture

### Fixed (修正)
- 修正 `aioftp` 版本相容性問題（0.21.4）
- 修正測試資料庫命名問題（保留大小寫 SYSDATA_test）
- 修正 Docker Compose 缺少環境變數（LOG_FILE_MAX_BYTES, LOG_FILE_BACKUP_COUNT）

---

## [版本號說明]

### 版本格式：主版本.次版本.修訂號 (MAJOR.MINOR.PATCH)

- **主版本 (MAJOR)**: 不相容的 API 變更
- **次版本 (MINOR)**: 向下相容的功能新增
- **修訂號 (PATCH)**: 向下相容的問題修正

### 變更類型

- **Added**: 新增功能
- **Changed**: 既有功能的變更
- **Deprecated**: 即將移除的功能
- **Removed**: 已移除的功能
- **Fixed**: 問題修正
- **Security**: 安全性修正

---

## 如何更新此文件

每次發布新版本或進行重要變更時，請更新此文件：

1. 在 `[Unreleased]` 下新增變更
2. 發布時，將 `[Unreleased]` 的內容移至新版本號下
3. 註明發布日期（YYYY-MM-DD）
4. 依類型分類變更（Added/Changed/Fixed 等）
5. 簡潔描述變更內容

### 範例

```markdown
## [1.0.0] - 2025-10-15

### Added
- 新增 HTTP 排程任務 CRUD API
- 新增任務執行引擎

### Changed
- 優化資料庫查詢效能

### Fixed
- 修正任務執行時區問題
```

---

**最後更新**: 2025-10-05
