# API æ–‡ä»¶

## ğŸ“‹ ç›®éŒ„
- [API åŸºæœ¬è³‡è¨Š](#api-åŸºæœ¬è³‡è¨Š)
- [å¥åº·æª¢æŸ¥ API](#å¥åº·æª¢æŸ¥-api)
- [å³å°‡æ¨å‡ºçš„ API](#å³å°‡æ¨å‡ºçš„-api)
- [API è¦ç¯„](#api-è¦ç¯„)

---

## API åŸºæœ¬è³‡è¨Š

### Base URL
```
é–‹ç™¼ç’°å¢ƒ: http://localhost:8000
ç”Ÿç”¢ç’°å¢ƒ: https://your-domain.com
```

### API æ–‡ä»¶
- **Swagger UI**: `/docs`
- **ReDoc**: `/redoc`

### èªè­‰æ–¹å¼
```
ç›®å‰æœªå•Ÿç”¨èªè­‰
æœªä¾†å°‡ä½¿ç”¨ API Key èªè­‰ï¼ˆHeader: X-API-Keyï¼‰
```

### å›æ‡‰æ ¼å¼
æ‰€æœ‰ API å›æ‡‰å‡ç‚º JSON æ ¼å¼

#### æˆåŠŸå›æ‡‰
```json
{
  "status": "success",
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ"
}
```

#### éŒ¯èª¤å›æ‡‰
```json
{
  "status": "error",
  "error_code": "ERROR_CODE",
  "message": "éŒ¯èª¤è¨Šæ¯",
  "details": { ... }
}
```

---

## å¥åº·æª¢æŸ¥ API

### 1. API å¥åº·æª¢æŸ¥

æª¢æŸ¥ API æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œã€‚

**ç«¯é»**: `GET /health`

**è«‹æ±‚ç¯„ä¾‹**:
```bash
curl http://localhost:8000/health
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "status": "healthy",
  "timestamp": "2025-10-05T12:00:00.000000",
  "version": "1.0.0"
}
```

**ç‹€æ…‹ç¢¼**:
- `200 OK` - æœå‹™æ­£å¸¸

---

### 2. è³‡æ–™åº«å¥åº·æª¢æŸ¥

æª¢æŸ¥è³‡æ–™åº«é€£ç·šæ˜¯å¦æ­£å¸¸ã€‚

**ç«¯é»**: `GET /health/db`

**è«‹æ±‚ç¯„ä¾‹**:
```bash
curl http://localhost:8000/health/db
```

**å›æ‡‰ç¯„ä¾‹**ï¼ˆæˆåŠŸï¼‰:
```json
{
  "database_connected": true,
  "message": "Database connection is healthy"
}
```

**å›æ‡‰ç¯„ä¾‹**ï¼ˆå¤±æ•—ï¼‰:
```json
{
  "database_connected": false,
  "message": "Database connection failed: <error details>"
}
```

**ç‹€æ…‹ç¢¼**:
- `200 OK` - è³‡æ–™åº«é€£ç·šæ­£å¸¸
- `503 Service Unavailable` - è³‡æ–™åº«é€£ç·šå¤±æ•—

---

## å³å°‡æ¨å‡ºçš„ API

ä»¥ä¸‹ API ç«¯é»å°‡åœ¨å¾ŒçºŒç‰ˆæœ¬ä¸­å¯¦ä½œï¼š

### HTTP æ’ç¨‹ä»»å‹™ API

#### 1. å–å¾—æ‰€æœ‰ HTTP ä»»å‹™
```
GET /api/http/tasks
Query Parameters:
  - skip: int (é è¨­: 0)
  - limit: int (é è¨­: 100)
  - is_enabled: bool (é¸å¡«)
  - execution_status: string (é¸å¡«)
```

#### 2. å–å¾—å–®ä¸€ HTTP ä»»å‹™
```
GET /api/http/tasks/{task_id}
```

#### 3. å»ºç«‹ HTTP ä»»å‹™
```
POST /api/http/tasks
Body: {
  "prog_code": "string",
  "url": "string",
  "http_method": "GET|POST|PUT|DELETE",
  "cron_expression": "string",
  "is_enabled": true
}
```

#### 4. æ›´æ–° HTTP ä»»å‹™
```
PUT /api/http/tasks/{task_id}
Body: { ... }
```

#### 5. åˆªé™¤ HTTP ä»»å‹™
```
DELETE /api/http/tasks/{task_id}
```

---

### Mail æ’ç¨‹ä»»å‹™ API

#### 1. å–å¾—æ‰€æœ‰ Mail ä»»å‹™
```
GET /api/mail/tasks
```

#### 2. å–å¾—å–®ä¸€ Mail ä»»å‹™
```
GET /api/mail/tasks/{task_id}
```

#### 3. å»ºç«‹ Mail ä»»å‹™
```
POST /api/mail/tasks
Body: {
  "prog_code": "string",
  "smtp_server": "string",
  "smtp_port": 587,
  "to_addresses": "string",
  "subject": "string",
  "cron_expression": "string"
}
```

#### 4. æ›´æ–° Mail ä»»å‹™
```
PUT /api/mail/tasks/{task_id}
```

#### 5. åˆªé™¤ Mail ä»»å‹™
```
DELETE /api/mail/tasks/{task_id}
```

---

### FTP æ’ç¨‹ä»»å‹™ API

#### 1. å–å¾—æ‰€æœ‰ FTP ä»»å‹™
```
GET /api/ftp/tasks
```

#### 2. å–å¾—å–®ä¸€ FTP ä»»å‹™
```
GET /api/ftp/tasks/{task_id}
```

#### 3. å»ºç«‹ FTP ä»»å‹™
```
POST /api/ftp/tasks
Body: {
  "prog_code": "string",
  "ftp_host": "string",
  "ftp_port": 21,
  "ftp_protocol": "ftp|sftp",
  "cron_expression": "string"
}
```

#### 4. æ›´æ–° FTP ä»»å‹™
```
PUT /api/ftp/tasks/{task_id}
```

#### 5. åˆªé™¤ FTP ä»»å‹™
```
DELETE /api/ftp/tasks/{task_id}
```

---

### ä¾‹å¤–è¨˜éŒ„ API

#### 1. æŸ¥è©¢ä¾‹å¤–è¨˜éŒ„
```
GET /api/exceptions
Query Parameters:
  - service_type: HTTP|Mail|FTP (é¸å¡«)
  - start_date: date (é¸å¡«)
  - end_date: date (é¸å¡«)
  - skip: int
  - limit: int
```

#### 2. å–å¾—å–®ä¸€ä¾‹å¤–è¨˜éŒ„
```
GET /api/exceptions/{exception_id}
```

---

### åŸ·è¡Œæ­·å² API

#### 1. æŸ¥è©¢åŸ·è¡Œæ­·å²
```
GET /api/history
Query Parameters:
  - service_type: HTTP|Mail|FTP (é¸å¡«)
  - service_task_id: int (é¸å¡«)
  - is_success: bool (é¸å¡«)
  - start_date: date (é¸å¡«)
  - end_date: date (é¸å¡«)
  - skip: int
  - limit: int
```

#### 2. å–å¾—ä»»å‹™åŸ·è¡Œçµ±è¨ˆ
```
GET /api/history/statistics
Query Parameters:
  - service_type: HTTP|Mail|FTP
  - start_date: date
  - end_date: date
```

---

## API è¦ç¯„

### å‘½åè¦ç¯„

- ç«¯é»ä½¿ç”¨å°å¯«ï¼Œå–®å­—é–“ç”¨ `-` åˆ†éš”
- è³‡æºä½¿ç”¨è¤‡æ•¸å½¢å¼ï¼š`/tasks` è€Œé `/task`
- è·¯å¾‘åƒæ•¸ä½¿ç”¨ snake_caseï¼š`/tasks/{task_id}`

### HTTP æ–¹æ³•

| æ–¹æ³• | ç”¨é€” | ç¯„ä¾‹ |
|------|------|------|
| GET | æŸ¥è©¢è³‡æº | `GET /tasks` |
| POST | å»ºç«‹è³‡æº | `POST /tasks` |
| PUT | å®Œæ•´æ›´æ–°è³‡æº | `PUT /tasks/1` |
| PATCH | éƒ¨åˆ†æ›´æ–°è³‡æº | `PATCH /tasks/1` |
| DELETE | åˆªé™¤è³‡æº | `DELETE /tasks/1` |

### ç‹€æ…‹ç¢¼

| ç‹€æ…‹ç¢¼ | èªªæ˜ | ä½¿ç”¨æ™‚æ©Ÿ |
|--------|------|----------|
| 200 OK | æˆåŠŸ | GET/PUT/PATCH æˆåŠŸ |
| 201 Created | å·²å»ºç«‹ | POST æˆåŠŸå»ºç«‹è³‡æº |
| 204 No Content | ç„¡å…§å®¹ | DELETE æˆåŠŸ |
| 400 Bad Request | è«‹æ±‚éŒ¯èª¤ | åƒæ•¸é©—è­‰å¤±æ•— |
| 401 Unauthorized | æœªæˆæ¬Š | ç¼ºå°‘èªè­‰ |
| 403 Forbidden | ç¦æ­¢å­˜å– | æ¬Šé™ä¸è¶³ |
| 404 Not Found | æ‰¾ä¸åˆ°è³‡æº | è³‡æºä¸å­˜åœ¨ |
| 500 Internal Server Error | ä¼ºæœå™¨éŒ¯èª¤ | å…§éƒ¨éŒ¯èª¤ |
| 503 Service Unavailable | æœå‹™ä¸å¯ç”¨ | è³‡æ–™åº«é€£ç·šå¤±æ•— |

### åˆ†é 

æ‰€æœ‰åˆ—è¡¨ API æ”¯æ´åˆ†é ï¼š

**Query Parameters**:
- `skip`: è·³éç­†æ•¸ï¼ˆé è¨­: 0ï¼‰
- `limit`: é™åˆ¶ç­†æ•¸ï¼ˆé è¨­: 100, æœ€å¤§: 1000ï¼‰

**å›æ‡‰æ ¼å¼**:
```json
{
  "total": 150,
  "skip": 0,
  "limit": 100,
  "data": [ ... ]
}
```

### éæ¿¾èˆ‡æ’åº

**éæ¿¾**:
```
GET /api/http/tasks?is_enabled=true&execution_status=Pending
```

**æ’åº**:
```
GET /api/http/tasks?sort=created_date&order=desc
```

### æ—¥æœŸæ™‚é–“æ ¼å¼

æ‰€æœ‰æ—¥æœŸæ™‚é–“ä½¿ç”¨ ISO 8601 æ ¼å¼ï¼š
```
2025-10-05T12:00:00.000000
```

### éŒ¯èª¤ç¢¼

| éŒ¯èª¤ç¢¼ | èªªæ˜ |
|--------|------|
| `VALIDATION_ERROR` | è³‡æ–™é©—è­‰å¤±æ•— |
| `DATABASE_ERROR` | è³‡æ–™åº«éŒ¯èª¤ |
| `NOT_FOUND` | è³‡æºä¸å­˜åœ¨ |
| `DUPLICATE_ENTRY` | è³‡æ–™é‡è¤‡ |
| `AUTHENTICATION_ERROR` | èªè­‰å¤±æ•— |
| `AUTHORIZATION_ERROR` | æˆæ¬Šå¤±æ•— |
| `INTERNAL_ERROR` | å…§éƒ¨éŒ¯èª¤ |

---

## ç¯„ä¾‹

### å»ºç«‹ HTTP ä»»å‹™ï¼ˆå³å°‡æ¨å‡ºï¼‰

**è«‹æ±‚**:
```bash
curl -X POST http://localhost:8000/api/http/tasks \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "prog_code": "DAILY_REPORT",
    "url": "https://api.example.com/report",
    "http_method": "GET",
    "cron_expression": "0 9 * * *",
    "is_enabled": true,
    "description": "æ¯æ—¥æ—©ä¸Š9é»å–å¾—å ±è¡¨"
  }'
```

**å›æ‡‰**:
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "prog_code": "DAILY_REPORT",
    "url": "https://api.example.com/report",
    "http_method": "GET",
    "cron_expression": "0 9 * * *",
    "is_enabled": true,
    "description": "æ¯æ—¥æ—©ä¸Š9é»å–å¾—å ±è¡¨",
    "execution_status": "Pending",
    "created_date": "2025-10-05T12:00:00.000000",
    "updated_date": "2025-10-05T12:00:00.000000"
  },
  "message": "ä»»å‹™å»ºç«‹æˆåŠŸ"
}
```

---

### æŸ¥è©¢ä»»å‹™åˆ—è¡¨ï¼ˆå³å°‡æ¨å‡ºï¼‰

**è«‹æ±‚**:
```bash
curl "http://localhost:8000/api/http/tasks?skip=0&limit=10&is_enabled=true" \
  -H "X-API-Key: your-api-key"
```

**å›æ‡‰**:
```json
{
  "total": 5,
  "skip": 0,
  "limit": 10,
  "data": [
    {
      "id": 1,
      "prog_code": "DAILY_REPORT",
      "url": "https://api.example.com/report",
      "http_method": "GET",
      "is_enabled": true,
      "execution_status": "Pending",
      "created_date": "2025-10-05T12:00:00.000000"
    },
    {
      "id": 2,
      "prog_code": "HOURLY_SYNC",
      "url": "https://api.example.com/sync",
      "http_method": "POST",
      "is_enabled": true,
      "execution_status": "Completed",
      "created_date": "2025-10-05T11:00:00.000000"
    }
  ]
}
```

---

## æ›´æ–°ç´€éŒ„

### 2025-10-05
- âœ… å»ºç«‹ API æ–‡ä»¶æ¶æ§‹
- âœ… å¯¦ä½œå¥åº·æª¢æŸ¥ API
- ğŸ“ è¦åŠƒ HTTP/Mail/FTP ä»»å‹™ API

### æœªä¾†æ›´æ–°
- ğŸš§ å¯¦ä½œ HTTP ä»»å‹™ CRUD API
- ğŸš§ å¯¦ä½œ Mail ä»»å‹™ CRUD API
- ğŸš§ å¯¦ä½œ FTP ä»»å‹™ CRUD API
- ğŸš§ å¯¦ä½œä¾‹å¤–è¨˜éŒ„ API
- ğŸš§ å¯¦ä½œåŸ·è¡Œæ­·å² API
- ğŸš§ æ–°å¢ API èªè­‰æ©Ÿåˆ¶

---

**æç¤º**:
- å®Œæ•´çš„äº’å‹•å¼ API æ–‡ä»¶è«‹è¨ªå• `/docs`ï¼ˆSwagger UIï¼‰
- API æœ‰è®Šæ›´æ™‚è«‹åŒæ­¥æ›´æ–° `3.CHANGELOG.md`
